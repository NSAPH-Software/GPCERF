<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates the conditional exposure response function (cerf) using
the nearest neighbor (nn) Gaussian Process (gp). The function tune the best
match (the lowest covariate balance) for the provided set of hyperparameters."><title>Estimate the Conditional Exposure Response Function using Nearest Neighbor Gaussian Process — estimate_cerf_nngp • GPCERF</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate the Conditional Exposure Response Function using Nearest Neighbor Gaussian Process — estimate_cerf_nngp"><meta property="og:description" content="Estimates the conditional exposure response function (cerf) using
the nearest neighbor (nn) Gaussian Process (gp). The function tune the best
match (the lowest covariate balance) for the provided set of hyperparameters."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GPCERF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/GPCERF.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/Estimate-CERF-GP.html">Estimate-CERF-GP</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Collabration</h6>
    <a class="dropdown-item" href="../articles/Developers-Guide.html">Developers-Guide</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NSAPH-Software/GPCERF/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Estimate the Conditional Exposure Response Function using Nearest Neighbor Gaussian Process</h1>
      <small class="dont-index">Source: <a href="https://github.com/NSAPH-Software/GPCERF/blob/HEAD/R/estimate_cerf_nngp.R" class="external-link"><code>R/estimate_cerf_nngp.R</code></a></small>
      <div class="d-none name"><code>estimate_cerf_nngp.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the conditional exposure response function (cerf) using
the nearest neighbor (nn) Gaussian Process (gp). The function tune the best
match (the lowest covariate balance) for the provided set of hyperparameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">estimate_cerf_nngp</span><span class="op">(</span><span class="va">data</span>, <span class="va">w</span>, <span class="va">GPS_m</span>, <span class="va">params</span>, <span class="va">kernel_fn</span><span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>data</dt>
<dd><p>A data.table of observation data.</p><ul><li><p>Column 1: Outcome (Y)</p></li>
<li><p>Column 2: Exposure or treatment (w)</p></li>
<li><p>Column 3~m: Confounders (C)</p></li>
</ul></dd>
<dt>w</dt>
<dd><p>A vector of exposure level to compute CERF.</p></dd>
<dt>GPS_m</dt>
<dd><p>A data.table of GPS vectors.</p><ul><li><p>Column 1: GPS</p></li>
<li><p>Column 2: Prediction of exposure for covariate of each data sample (e_gps_pred).</p></li>
<li><p>Column 3: Standard deviation of  e_gps (e_gps_std)</p></li>
</ul></dd>
<dt>params</dt>
<dd><p>A list of parameters that is required to run the process.
These parameters include:</p><ul><li><p>alpha: A scaling factor for the GPS value.</p></li>
<li><p>beta: A scaling factor for the exposure value.</p></li>
<li><p>g_sigma: A scaling factor for kernel function (gamma/sigma).</p></li>
<li><p>tune_app: A tuning approach. Available approaches:</p><ul><li><p>all: try all combinations of hyperparameters.</p></li>
</ul></li>
<li><p>expand: Scaling factor to determine the total number of nearest neighbors.
The total is <code>2*expand*n.neighbour</code>.</p></li>
<li><p>n_neighbor: Number of nearest neighbors on one side.</p></li>
<li><p>block_size: Number of samples included in a computation block. Mainly
used to balance the speed and memory requirement. Larger <code>block_size</code>
is faster, but requires more memory.
alpha, beta, and g_sigma can be a vector of parameters.</p></li>
</ul></dd>
<dt>kernel_fn</dt>
<dd><p>A kernel function. A default value is a Gaussian Kernel.</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>#' A cerf_nngp object that includes the following values:</p><ul><li><p>TBD</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">19</span><span class="op">)</span></span>
<span class="r-in"><span class="va">sim.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">200</span>, gps_spec <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Estimate GPS function</span></span>
<span class="r-in"><span class="va">GPS_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="train_GPS.html">train_GPS</a></span><span class="op">(</span>cov.mt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sim.data</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span class="r-in">                   w.all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">sim.data</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]	train-rmse:7.836669 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2]	train-rmse:6.134167 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3]	train-rmse:4.915488 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4]	train-rmse:3.988384 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5]	train-rmse:3.336050 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6]	train-rmse:2.859457 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7]	train-rmse:2.479927 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8]	train-rmse:2.112485 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [9]	train-rmse:1.843607 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10]	train-rmse:1.648466 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11]	train-rmse:1.506709 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12]	train-rmse:1.381182 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13]	train-rmse:1.257668 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14]	train-rmse:1.156825 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15]	train-rmse:1.116339 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16]	train-rmse:1.041766 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17]	train-rmse:0.910545 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18]	train-rmse:0.880408 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19]	train-rmse:0.809074 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20]	train-rmse:0.728130 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21]	train-rmse:0.638991 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [22]	train-rmse:0.601759 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [23]	train-rmse:0.550966 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [24]	train-rmse:0.531337 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25]	train-rmse:0.482819 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26]	train-rmse:0.452625 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [27]	train-rmse:0.431795 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [28]	train-rmse:0.402634 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29]	train-rmse:0.387928 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [30]	train-rmse:0.367107 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31]	train-rmse:0.346419 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [32]	train-rmse:0.335399 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33]	train-rmse:0.326148 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [34]	train-rmse:0.299594 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [35]	train-rmse:0.282238 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36]	train-rmse:0.264984 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37]	train-rmse:0.249363 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [38]	train-rmse:0.244614 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [39]	train-rmse:0.228311 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [40]	train-rmse:0.218213 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41]	train-rmse:0.207740 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [42]	train-rmse:0.194086 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [43]	train-rmse:0.189707 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [44]	train-rmse:0.172412 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [45]	train-rmse:0.159344 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [46]	train-rmse:0.143543 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [47]	train-rmse:0.133508 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [48]	train-rmse:0.124262 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [49]	train-rmse:0.112816 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [50]	train-rmse:0.109303 </span>
<span class="r-in"><span class="co"># exposure values</span></span>
<span class="r-in"><span class="va">w.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">0.5</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">sim.data</span><span class="op">)</span></span>
<span class="r-in"><span class="va">cerf_nngp_obj</span> <span class="op">&lt;-</span> <span class="fu">estimate_cerf_nngp</span><span class="op">(</span><span class="va">sim.data</span>,</span>
<span class="r-in">                                    <span class="va">w.all</span>,</span>
<span class="r-in">                                    <span class="va">GPS_m</span>,</span>
<span class="r-in">                                    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span><span class="op">)</span>,</span>
<span class="r-in">                                                  beta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span class="r-in">                                                  g_sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">                                                  tune_app <span class="op">=</span> <span class="st">"all"</span>,</span>
<span class="r-in">                                                  n_neighbor <span class="op">=</span> <span class="fl">20</span>,</span>
<span class="r-in">                                                  expand <span class="op">=</span> <span class="fl">1</span>,</span>
<span class="r-in">                                                  block_size <span class="op">=</span> <span class="fl">1e4</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Naeem Khoshnevis, Boyu Ren, Tanujt Dey, Danielle Braun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

