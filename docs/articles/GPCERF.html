<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GPCERF">
<title>GPCERF â€¢ GPCERF</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="GPCERF">
<meta property="og:description" content="GPCERF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GPCERF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/GPCERF.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/Full-Gaussian-Processes.html">Full Gaussian Processes</a>
    <a class="dropdown-item" href="../articles/Nearest-neighbor-Gaussian-Processes.html">Nearest-neighbor Gaussian Processes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NSAPH-Software/GPCERF/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>GPCERF</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NSAPH-Software/GPCERF/blob/HEAD/vignettes/GPCERF.Rmd" class="external-link"><code>vignettes/GPCERF.Rmd</code></a></small>
      <div class="d-none name"><code>GPCERF.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://devtools.r-lib.org/" class="external-link">"devtools"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"NSAPH-Software/GPCERF"</span>, ref<span class="op">=</span><span class="st">"main"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/NSAPH-Software/GPCERF" class="external-link">"GPCERF"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<div class="section level3">
<h3 id="estimating-gps-values">Estimating GPS values<a class="anchor" aria-label="anchor" href="#estimating-gps-values"></a>
</h3>
<p>Input parameters:</p>
<p><strong><code>cov_mt</code></strong> Covariate matrix containing all
covariates. Each row represents a sample, and each column is a
covariate.<br><strong><code>w_all</code></strong> A vector of observed exposure
level.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">GPS_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_gps.html">train_gps</a></span><span class="op">(</span>cov_mt <span class="op">=</span> <span class="va">mydata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cf1"</span>, <span class="st">"cf2"</span>, <span class="st">"cf3"</span>, <span class="st">"cf4"</span>,</span>
<span>                                       <span class="st">"cf5"</span>, <span class="st">"cf6"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                  w_all <span class="op">=</span> <span class="va">mydata</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                  sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.xgboost"</span><span class="op">)</span>,</span>
<span>                  dnorm_log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nnls</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">GPS_m</span><span class="op">)</span></span>
<span><span class="co">#&gt;          GPS e_gps_pred e_gps_std</span></span>
<span><span class="co">#&gt; 1 0.01081022   8.197929 0.9413531</span></span>
<span><span class="co">#&gt; 2 0.08043211   5.114018 0.9413531</span></span>
<span><span class="co">#&gt; 3 0.19488618   6.077386 0.9413531</span></span>
<span><span class="co">#&gt; 4 0.40422488  12.200227 0.9413531</span></span>
<span><span class="co">#&gt; 5 0.02509882  -2.728654 0.9413531</span></span>
<span><span class="co">#&gt; 6 0.38230674  10.233231 0.9413531</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="estimating-exposure-response-using-gaussian-processes">Estimating exposure response using Gaussian Processes<a class="anchor" aria-label="anchor" href="#estimating-exposure-response-using-gaussian-processes"></a>
</h3>
<p>Input parameters:</p>
<p><strong><code>data</code></strong> A data.frame of observation
data.<br>
- Column 1: Outcome (Y)<br>
- Column 2: Exposure or treatment (w)<br>
- Column 3~m: Confounders (C)<br><strong><code>w</code></strong> A vector of exposure level to compute
CERF.<br><strong><code>GPS_m</code></strong> A data.frame of GPS vectors.<br>
- Column 1: GPS<br>
- Column 2: Prediction of exposure for covariate of each data sample
(e_gps_pred)<br>
- Column 3: Standard deviation of e_gps (e_gps_std)<br><strong><code>params</code></strong> A list of parameters that is
required to run the process.<br>
- alpha: A scaling factor for the GPS value.<br>
- beta: A scaling factor for the exposure value.<br>
- g_sigma: A scaling factor for kernel function (gamma/sigma).<br>
- tune_app: A tuning approach. Available approaches:<br>
- all: try all combinations of hyperparameters.</p>
<p>alpha, beta, and g_sigma can be a vector of parameters.</p>
<p><strong><code>nthread</code></strong> An integer value that
represents the number of threads to be used in a shared memory
system.<br><strong><code>kernel_fn</code></strong> A kernel function. A default
value is a Gaussian kernel.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">129</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">200</span>, gps_spec <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate GPS function</span></span>
<span><span class="va">GPS_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_gps.html">train_gps</a></span><span class="op">(</span>cov_mt <span class="op">=</span> <span class="va">sim_data</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   w_all <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                   sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.xgboost"</span><span class="op">)</span>,</span>
<span>                   dnorm_log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># exposure values</span></span>
<span><span class="va">w_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">cerf_gp_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_cerf_gp.html">estimate_cerf_gp</a></span><span class="op">(</span><span class="va">sim_data</span>,</span>
<span>                               <span class="va">w_all</span>,</span>
<span>                               <span class="va">GPS_m</span>,</span>
<span>                               params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.4</span><span class="op">)</span>,</span>
<span>                                             beta<span class="op">=</span><span class="fl">0.2</span>,</span>
<span>                                             g_sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                             tune_app <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>,</span>
<span>                               nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cerf_gp_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="GPCERF_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="estimating-exposure-response-using-nearest-neighbor-gaussian-processes">Estimating exposure response using nearest-neighbor Gaussian
Processes<a class="anchor" aria-label="anchor" href="#estimating-exposure-response-using-nearest-neighbor-gaussian-processes"></a>
</h3>
<p>Input parameters:</p>
<p><strong><code>data</code></strong> A data.frame of observation
data.<br>
- Column 1: Outcome (Y)<br>
- Column 2: Exposure or treatment (w)<br>
- Column 3~m: Confounders (C)<br><strong><code>w</code></strong> A vector of exposure level to compute
CERF.<br><strong><code>GPS_m</code></strong> A data.frame of GPS vectors.<br>
- Column 1: GPS<br>
- Column 2: Prediction of exposure for covariate of each data sample
(e_gps_pred)<br>
- Column 3: Standard deviation of e_gps (e_gps_std)<br><strong><code>params</code></strong> A list of parameters that is
required to run the process.<br>
- alpha: A scaling factor for the GPS value.<br>
- beta: A scaling factor for the exposure value.<br>
- g_sigma: A scaling factor for kernel function (gamma/sigma).<br>
- tune_app: A tuning approach. Available approaches:<br>
- all: try all combinations of hyperparameters.<br>
- expand: Scaling factor to determine the total number of nearest
neighbors.<br>
- n_neighbors: Number of nearest neighbors on one side.<br>
- block_size: Number of samples included in a computation block. Mainly
used to balance speed and memory requirement. Larger is faster, but
requires more memory.</p>
<p>alpha, beta, and g_sigma can be a vector of parameters.</p>
<p><strong><code>nthread</code></strong> An integer value that
represents the number of threads to be used in a shared memory
system.<br><strong><code>kernel_fn</code></strong> A kernel function. A default
value is a Gaussian kernel.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">19</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">200</span>, gps_spec <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Estimate GPS function</span></span>
<span><span class="va">GPS_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_gps.html">train_gps</a></span><span class="op">(</span>cov_mt <span class="op">=</span> <span class="va">sim_data</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                   w_all <span class="op">=</span> <span class="va">sim_data</span><span class="op">$</span><span class="va">treat</span>,</span>
<span>                   sl_lib <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SL.xgboost"</span><span class="op">)</span>,</span>
<span>                   dnorm_log <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># exposure values</span></span>
<span><span class="va">w_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">cerf_nngp_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_cerf_nngp.html">estimate_cerf_nngp</a></span><span class="op">(</span><span class="va">sim_data</span>,</span>
<span>                                    <span class="va">w_all</span>,</span>
<span>                                    <span class="va">GPS_m</span>,</span>
<span>                                    params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>                                                  beta <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>                                                  g_sigma <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                  tune_app <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>                                                  n_neighbor <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                                  expand <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                                  block_size <span class="op">=</span> <span class="fl">1e4</span><span class="op">)</span>,</span>
<span>                                    formula <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">treat</span>,</span>
<span>                                    nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">cerf_nngp_obj</span><span class="op">)</span></span></code></pre></div>
<p><img src="GPCERF_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a>
</h3>
<p>The GPCERF package logs internal activities into the screen or
<code>GPCERF.log</code> file. Users can change the logging file name
(and path) and logging threshold. The logging mechanism has different
thresholds (see <a href="https://cran.r-project.org/package=logger" class="external-link">logger</a> package).
The two most important thresholds are INFO and DEBUG levels. The former,
which is the default level, logs more general information about the
process. The latter, if activated, logs more detailed information that
can be used for debugging purposes. The log file is located in the
source file location and will be appended.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Naeem Khoshnevis, Boyu Ren, Danielle Braun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
