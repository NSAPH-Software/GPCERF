<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="GPCERF">
<title>Full Gaussian Processes • GPCERF</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Full Gaussian Processes">
<meta property="og:description" content="GPCERF">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">GPCERF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/GPCERF.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/Full-Gaussian-Processes.html">Full Gaussian Processes</a>
    <a class="dropdown-item" href="../articles/Nearest-neighbor-Gaussian-Processes.html">Nearest-neighbor Gaussian Processes</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/NSAPH-Software/GPCERF/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Full Gaussian Processes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NSAPH-Software/GPCERF/blob/HEAD/vignettes/Full-Gaussian-Processes.Rmd" class="external-link"><code>vignettes/Full-Gaussian-Processes.Rmd</code></a></small>
      <div class="d-none name"><code>Full-Gaussian-Processes.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/NSAPH-Software/GPCERF" class="external-link">GPCERF</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: replacing previous import 'vctrs::data_frame' by 'tibble::data_frame'</span>
<span class="co">#&gt; when loading 'dplyr'</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p>In this vignette, we present an example of using full Gaussian processes approach in GPCERF to estimate the exposure response function (ERF) of a continuous exposure based on simulated data. We use a synthetic data generation function from the R package <a href="https://fasrc.github.io/CausalGPS/index.html" class="external-link">CausalGPS</a>.</p>
<div class="section level2">
<h2 id="generate-synthetic-data">Generate Synthetic Data<a class="anchor" aria-label="anchor" href="#generate-synthetic-data"></a>
</h2>
<p>We first generate a synthetic dataset with six covariates, one continuous exposure and one outcome. We consider two types of conditional distributions (normal and student’s t) of the exposure given covariates. For more details of the synthetic data generation, see this <a href="https://fasrc.github.io/CausalGPS/articles/Generating-Synthetic-Data.html" class="external-link">document</a>. We then use a function <code>tru_R</code> to derive the actual ERF of this population at <code>w=seq(0,20,0.1)</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">134</span><span class="op">)</span>
<span class="co"># Generate dataset with a normally distributed exposure given covariates</span>
<span class="va">data_sim_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">400</span>, 
                                          outcome_sd <span class="op">=</span> <span class="fl">10</span>, 
                                          gps_spec <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># Generate dataset with a t-distributed with 2df exposure given covariates</span>
<span class="va">data_sim_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_synthetic_data.html">generate_synthetic_data</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fl">400</span>, 
                                     outcome_sd <span class="op">=</span> <span class="fl">10</span>, 
                                     gps_spec <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="va">tru_R</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">w</span>, <span class="va">sim.data</span><span class="op">)</span><span class="op">{</span>
  <span class="va">design.mt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span><span class="va">cf1</span><span class="op">+</span><span class="va">cf2</span><span class="op">+</span><span class="va">cf3</span><span class="op">+</span><span class="va">cf4</span><span class="op">+</span><span class="va">cf5</span><span class="op">+</span><span class="va">cf6</span><span class="op">-</span><span class="fl">1</span>, data <span class="op">=</span> <span class="va">sim.data</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">design.mt</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="op">-</span><span class="fl">10</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">*</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span>
      <span class="va">w</span><span class="op">*</span><span class="op">(</span><span class="fl">0.1</span> <span class="op">-</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.13</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="va">w</span><span class="op">^</span><span class="fl">3</span>
  <span class="op">}</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">erf_tru_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu">tru_R</span><span class="op">(</span><span class="va">w</span>, <span class="va">data_sim_normal</span><span class="op">)</span><span class="op">)</span>
<span class="va">erf_tru_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">0.1</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu">tru_R</span><span class="op">(</span><span class="va">w</span>, <span class="va">data_sim_t</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="estimate-erf-with-full-gaussian-processes">Estimate ERF with full Gaussian Processes<a class="anchor" aria-label="anchor" href="#estimate-erf-with-full-gaussian-processes"></a>
</h2>
<div class="section level3">
<h3 id="train-gps-model">Train GPS Model<a class="anchor" aria-label="anchor" href="#train-gps-model"></a>
</h3>
<p>GPCERF will first convert the covariate values into a single composite score (GPS) and then use it to fit the Gaussian processes. We use the GPS estimation function in CasaulGPS (see <a href="https://fasrc.github.io/CausalGPS/articles/Estimating-GPS.html" class="external-link">here</a>) to get the GPS model that maps covariates into GPS.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">GPS_m_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_GPS.html">train_GPS</a></span><span class="op">(</span>cov.mt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_sim_normal</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
                          w.all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_sim_normal</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span>
<span class="va">GPS_m_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/train_GPS.html">train_GPS</a></span><span class="op">(</span>cov.mt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_sim_t</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,
                          w.all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">data_sim_t</span><span class="op">$</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We then use <code>estimate_cerf_gp</code> to estimate the ERF of the expsoure <code>w</code>. We estimate the ERF at <code>w = seq(0,20,0.1)</code>. The estimated ERF as well as its pointwise 95% credible band is visualized with a call to <code>plot</code>. We also plot the actual ERF on top of the estimated ERF.</p>
</div>
<div class="section level3">
<h3 id="normally-distributed-exposure">Normally Distributed Exposure<a class="anchor" aria-label="anchor" href="#normally-distributed-exposure"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">w_all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span>,<span class="fl">0.1</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">data_sim_normal</span><span class="op">)</span>

<span class="va">gp_res_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_cerf_gp.html">estimate_cerf_gp</a></span><span class="op">(</span><span class="va">data_sim_normal</span>,
                                  <span class="va">w_all</span>,
                                  <span class="va">GPS_m_normal</span>,
                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,
                                                beta<span class="op">=</span><span class="fl">0.2</span>,
                                                g_sigma <span class="op">=</span> <span class="fl">1</span>,
                                                tune_app <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>,
                                  nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gp_res_normal</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w_all</span>, y <span class="op">=</span> <span class="va">erf_tru_normal</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"True"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<p><img src="Full-Gaussian-Processes_files/figure-html/unnamed-chunk-4-1.png" width="700"><img src="Full-Gaussian-Processes_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>We can see that the estimated curve follows the true ERF closely and the 95% credible band completely covers the true ERF.</p>
</div>
<div class="section level3">
<h3 id="t-distributed-exposure">T-distributed Exposure<a class="anchor" aria-label="anchor" href="#t-distributed-exposure"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">data_sim_t</span><span class="op">)</span>

<span class="va">gp_res_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_cerf_gp.html">estimate_cerf_gp</a></span><span class="op">(</span><span class="va">data_sim_t</span>,
                                  <span class="va">w_all</span>,
                                  <span class="va">GPS_m_t</span>,
                                  params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,
                                                beta<span class="op">=</span><span class="fl">0.2</span>,
                                                g_sigma <span class="op">=</span> <span class="fl">1</span>,
                                                tune_app <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span>,
                                  nthread <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gp_res_t</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>w <span class="op">=</span> <span class="va">w_all</span>, y <span class="op">=</span> <span class="va">erf_tru_t</span><span class="op">)</span>, 
            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">w</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="st">"True"</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<p><img src="Full-Gaussian-Processes_files/figure-html/unnamed-chunk-5-1.png" width="700"><img src="Full-Gaussian-Processes_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<p>The results look very similar to the case where the exposure is normally distributed. The only difference might be that when the exposure is t-distributed, the estimated curve tends to be less smooth.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Naeem Khoshnevis, Boyu Ren, Tanujt Dey, Danielle Braun.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
